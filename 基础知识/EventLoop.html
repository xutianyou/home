<!DOCTYPE html>
<html>
<head>
  <title>Event Loop</title>
  <style type="text/css">
    .outer {
      width: 200px;
      height: 200px;
      background-color: yellow;
    }

    .inner {
      width: 100px;
      height: 100px;
      background-color: red;
    }
  </style>
</head>
<body>
  <div class="outer">
    <div class="inner"></div>
  </div>
<script type="text/javascript">
// "Event Loop是一个程序结构，用于等待和发送消息和事件。

// 一个负责程序本身的运行，称为"主线程"；另一个负责主线程与其他进程（主要是各种I/O操作）的通信，被称为"Event Loop线程"

// 这种运行方式称为"异步模式"（asynchronous I/O）或"非堵塞模式"（non-blocking mode）。

/*
  宏任务 - MacroTask:
    script标签
    setImmediate
    setTimeout
    setInterval

  微任务 - MicroTask: 
    process.nextTick
    Promise
    MutaionObserver
    Object.observe 已废弃
*/
console.log('----------------')
// console.log(1);

// setTimeout(function() {
//   console.log(2);
// }, 0);

// new Promise(function(resolve,reject){
//     console.log(3)
//     resolve()
// }).then(function() {
//   console.log(4);
// }).then(function() {
//   console.log(5);
// });

// console.log(6);

// Let's get hold of those elements
var outer = document.querySelector('.outer');
var inner = document.querySelector('.inner');

// Let's listen for attribute changes on the
// outer element
new MutationObserver(function() {
  console.log('mutate');
}).observe(outer, {
  attributes: true
});

// Here's a click listener…
function onClick() {
  console.log('click');

  setTimeout(function() {
    console.log('timeout');
  }, 0);

  Promise.resolve().then(function() {
    console.log('promise');
  });
  const _random = Math.random();
  console.log(_random)
  outer.setAttribute('data-random', _random);
}

// …which we'll attach to both elements
inner.addEventListener('click', onClick);
outer.addEventListener('click', onClick);

console.log('-----------')

console.log(1)

setTimeout(() => {
    console.log(5)
    new Promise((resolve, reject) => {
        console.log(6)
        resolve()
    }).then(() => {
        console.log(7)
    })
}, 0)

new Promise((resolve, reject) => {
    console.log(2)
    resolve()
}).then(() => {
    console.log(4)
})

setTimeout(() => {
    console.log(8)
    new Promise((resolve, reject) => {
        console.log(9)
        resolve()
    }).then(() => {
        console.log(10)
    })
}, 0)

console.log(3)
</script>
</body>
</html>