<!DOCTYPE html>
<html>
<head>
  <title>流程控制</title>
</head>
<body>
<script type="text/javascript">
// 流程控制主要有三种结构：分别是顺序结构、分支结构和循环结构
function Queue() {
  this.dataStore = [];
  this.cun = 0;
  this.tr = false;
  this.resolve = () => {
    this.cun = this.cun + 1;
    console.log('cun', this.cun)
    this.finish();
  }
  this.reject = () => {
    this.cun = 0;
  }
}

Queue.prototype = {
  enqueue: function (fun) {
    this.dataStore.push(fun)
    return this
  },
  finish: function(lastFun) {
    console.log('finish', this.dataStore, lastFun)
    if (this.dataStore.length) {
        this.dataStore[this.cun](this.resolve, this.reject)
      // const promise = new Promise( (resolve, reject) => {
      //   console.log('1', this.tr)
      //   console.log('2', this.tr)
      //   if (this.tr) {
      //     resolve('resolve')
      //   } 
      //   else {
      //     reject('reject')
      //   }
      // })
      // promise.then((res) => {
      //   console.log('promise1', res)
      // }).catch((err) => {
      //   console.log('promise1err', err)
      // })
    }
  }
};
let queue = new Queue();

queue
.enqueue( (resolve, reject) => {
  console.log('enqueue1')
  setTimeout(() => {
    console.log(1)
    resolve()
  }, 1000)
})
.enqueue( (resolve, reject) => {
  console.log('enqueue2')
  console.log(2)
  resolve()
})
.enqueue( (resolve, reject) => {
  console.log('enqueue3')
  setTimeout(() => {
    console.log(3)
    resolve()
  }, 3000)
})
.enqueue( (resolve, reject) => {
  console.log('enqueue4')
})
.finish(() => {
  console.log('queue-finish')
})
</script>
</body>
</html>